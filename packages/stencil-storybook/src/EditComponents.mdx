import { Meta } from "@storybook/blocks";

<Meta title="Introduction/Ajouter, modifier ou supprimer des composants" />

<ap-heading size="h1" mb-64>Ajouter, modifier ou supprimer des composants</ap-heading>

<ap-heading size="h2" mb-16>Introduction</ap-heading>
<ap-paragraph mb-32>Les Web Components sont un ensemble de plusieurs technologies (html, css, js) qui permettent de créer des éléments personnalisés réutilisables, dont les fonctionnalités sont encapsulées en dehors du reste du code et qui peuvent être utilisées au sein d'applications web.</ap-paragraph>
<ap-paragraph mb-32>Ce kit de composants a été créé avec [stencil](https://stenciljs.com/), codé en typescript puis transpilé en vanilla JS, de ce fait il peut être installé dans n'importe quelle technologie (Angular, React, Vue, Wordpress, ...)</ap-paragraph>
<ap-paragraph mb-32><strong>StencilJS:</strong> Stencil est une chaîne d'outils permettant de créer des systèmes de conception réutilisables et évolutifs. Générez de petits composants Web ultra-rapides et 100 % basés sur des normes qui s'exécutent dans tous les navigateurs.</ap-paragraph>
<ap-paragraph mb-32><strong>Storybook:</strong> Storybook est un outil open source permettant de créer des composants et des pages d'interface utilisateur de manière isolée. Il rationalise le développement, les tests et la documentation de l'interface utilisateur. Dans notre cas, Storybook sera utilisé comme système de documentation.</ap-paragraph>
<ap-paragraph><strong>Lerna:</strong> Lerna est un système de monorepo qui permet de gérer plusieurs packages à la fois.</ap-paragraph>



<ap-heading size="h2" mt-64>Prérequis</ap-heading>
- <ap-paragraph>[NodeJS version > 18.13](https://nodejs.org/en)</ap-paragraph>
- <ap-paragraph>[Yarn](https://yarnpkg.com/getting-started/install)</ap-paragraph>
- <ap-paragraph>[Lerna 8](https://lerna.js.org/)</ap-paragraph>

<ap-heading size="h2" mt-64 mb-16>Cloner le projet</ap-heading>
<ap-paragraph>Le repository est disponible sur [ce lien](https://dev.azure.com/agilepartner/AP-DigitalFactory/_git/starter-web-components) ou alors via la commande ci-dessous:</ap-paragraph>
```
git clone https://agilepartner@dev.azure.com/agilepartner/AP-DigitalFactory/_git/starter-web-components
```
<ap-paragraph>⚠️<strong>Travailler depuis la branche dev</strong>⚠️</ap-paragraph>

<ap-heading size="h2" mt-64 mb-16>Installer le projet</ap-heading>
<ap-paragraph>Une fois à la racine de votre projet exécutez la commande `npm i` qui aura pour effet d'installer les dépendances de tous packages de notre monorepo (stencil-storybook et angular-workspace)</ap-paragraph>


<ap-heading size="h2" mt-64 mb-16>Lancer le projet</ap-heading>
<ap-paragraph>Se mettre à la racine du dossier stencil-storybook puis exécutez ces deux commandes en parallèle dans deux terminaux différents : </ap-paragraph>
- <ap-paragraph>`yarn stencil:start`</ap-paragraph>
- <ap-paragraph>`yarn storybook:start`</ap-paragraph>

<ap-paragraph>Dans de rares occasions le dossier dist de stencil est mal construit et créera un bug dans storybook, comme ci-dessous</ap-paragraph>
`[vite] Internal server error: Failed to resolve import "../dist/esm/polyfills/index.js" from "loader\index.js". Does the file exist?   `
<ap-paragraph>Il y a deux possibilités pour résoudre ce bug :</ap-paragraph>
- <ap-paragraph>Relancer la commande `yarn stencil:start` afin d'essayer de reconstruire correctement le dossier dist</ap-paragraph>
- <ap-paragraph>Faire une sauvegarde d'un fichier .scss ou .tsx appartenant à stencil, cela reconstruira le dossier dist (il se peut que plusieurs tentatives soient nécessaires)</ap-paragraph>


<ap-heading size="h2" mt-64 mb-16>Publier les packages</ap-heading>
<ap-paragraph>Voici la démarche à suivre lorsque vous jugez que vos modifications sont prêtes à être packagées: </ap-paragraph>
- A la racine du projet la commande <ap-paragraph>`yarn all-components:build`</ap-paragraph> va avoir pour effet de créer des dossiers de distrubution prêts à être packager
- La commande <ap-paragraph>`lerna publish`</ap-paragraph> vous demandera de choisir entre une version version mineur ou majeur. Suite à votre réponse lerna publiera sur le registry d'agilepartner vos nouveaux packages

<ap-paragraph mb-32><strong>Important: </strong> Il est primordial d'avoir un fichier .nmprc à la racine de son projet contenant le code ci-dessous pour installer les packages. Les packages sont normalements stockés sur le registy public NPM, dans notre cas les packages sont stockés en interne dans notre azure</ap-paragraph>
```
registry=https://pkgs.dev.azure.com/agilepartner/AP-DigitalFactory/_packaging/web-components/npm/registry/
always-auth=true

; begin auth token
//pkgs.dev.azure.com/agilepartner/AP-DigitalFactory/_packaging/web-components/npm/registry/:username=agilepartner
//pkgs.dev.azure.com/agilepartner/AP-DigitalFactory/_packaging/web-components/npm/registry/:_password=ZHVhcG9kcHZ2N3V1cHR2ZW81aTN3cnZ1dnV5c3FuZWlzM29udTZ5eTJlYXdxZ216bjQ3YQ==
//pkgs.dev.azure.com/agilepartner/AP-DigitalFactory/_packaging/web-components/npm/registry/:email=lsciampagna@agilepartner.net
//pkgs.dev.azure.com/agilepartner/AP-DigitalFactory/_packaging/web-components/npm/:username=agilepartner
//pkgs.dev.azure.com/agilepartner/AP-DigitalFactory/_packaging/web-components/npm/:_password=ZHVhcG9kcHZ2N3V1cHR2ZW81aTN3cnZ1dnV5c3FuZWlzM29udTZ5eTJlYXdxZ216bjQ3YQ==
//pkgs.dev.azure.com/agilepartner/AP-DigitalFactory/_packaging/web-components/npm/:email=lsciampagna@agilepartner.net
; end auth token
```
